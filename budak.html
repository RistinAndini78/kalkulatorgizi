<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Gizi Lanjut</title>
    <style>
        body {
            font-family: sans-serif;
        }
        .container {
            width: 80%;
            margin: 20px auto;
        }
        .input-section, .hasil-section, .grafik-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ccc;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input[type="number"], input[type="date"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        button {
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }
        #hasil {
            margin-top: 20px;
        }
        .grafik-container {
            width: 100%;
            max-width: 600px;
            margin: 10px auto;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <h1>Kalkulator Gizi Lanjut</h1>

        <div class="input-section">
            <h2>Data Pengguna</h2>
            <label for="tinggi">Tinggi Badan (cm):</label>
            <input type="number" id="tinggi">

            <label for="berat-sekarang">Berat Badan Sekarang (kg):</label>
            <input type="number" id="berat-sekarang">

            <label for="usia">Usia (tahun):</label>
            <input type="number" id="usia">

            <label for="jenis-kelamin">Jenis Kelamin:</label>
            <select id="jenis-kelamin">
                <option value="pria">Pria</option>
                <option value="wanita">Wanita</option>
            </select>

            <label for="aktivitas">Tingkat Aktivitas:</label>
            <select id="aktivitas">
                <option value="ringan">Ringan (sedikit/tanpa olahraga)</option>
                <option value="sedang">Sedang (olahraga 1-3 kali seminggu)</option>
                <option value="berat">Berat (olahraga 4-5 kali seminggu)</option>
                <option value="sangat-berat">Sangat Berat (olahraga intensif setiap hari)</option>
            </select>
        </div>

        <div class="input-section">
            <h2>Riwayat Berat dan Tinggi Badan (Opsional untuk Grafik)</h2>
            <div id="riwayat-data">
                <div class="data-row">
                    <label>Tanggal:</label>
                    <input type="date" class="tanggal-input">
                    <label>Berat (kg):</label>
                    <input type="number" class="berat-riwayat">
                    <label>Tinggi (cm):</label>
                    <input type="number" class="tinggi-riwayat">
                </div>
            </div>
            <button id="tambah-riwayat">Tambah Riwayat</button>
        </div>

        <button id="hitung">Hitung Gizi</button>

        <div id="hasil" class="hasil-section" style="display: none;">
            <h2>Hasil Perhitungan</h2>
            <p><strong>Indeks Massa Tubuh (IMT):</strong> <span id="imt-hasil"></span></p>
            <p><strong>Berat Badan Ideal (BBI):</strong> <span id="bbi-hasil"></span> kg</p>
            <p><strong>Total Energi Harian (TEE):</strong> <span id="tee-hasil"></span> kalori</p>
            <p><strong>Protein Harian (10-15%):</strong> <span id="protein-hasil"></span> gram</p>
            <p><strong>Karbohidrat Harian (45-65%):</strong> <span id="karbohidrat-hasil"></span> gram</p>
            <p><strong>Lemak Harian (20-35%):</strong> <span id="lemak-hasil"></span> gram</p>
            <p><strong>Laju Perubahan Berat Badan Terhadap Waktu (Perkiraan):</strong> <span id="laju-berat-hasil"></span> kg/hari</p>
        </div>

        <div class="grafik-section" style="display: none;">
            <h2>Grafik</h2>
            <div class="grafik-container">
                <canvas id="grafik-berat-tinggi"></canvas>
            </div>
            <div class="grafik-container">
                <canvas id="grafik-berat-waktu"></canvas>
            </div>
            <div class="grafik-container">
                <canvas id="grafik-tinggi-waktu"></canvas>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tinggiInput = document.getElementById('tinggi');
            const beratSekarangInput = document.getElementById('berat-sekarang');
            const usiaInput = document.getElementById('usia');
            const jenisKelaminSelect = document.getElementById('jenis-kelamin');
            const aktivitasSelect = document.getElementById('aktivitas');
            const hitungButton = document.getElementById('hitung');
            const hasilDiv = document.getElementById('hasil');
            const imtHasilSpan = document.getElementById('imt-hasil');
            const bbiHasilSpan = document.getElementById('bbi-hasil');
            const teeHasilSpan = document.getElementById('tee-hasil');
            const proteinHasilSpan = document.getElementById('protein-hasil');
            const karbohidratHasilSpan = document.getElementById('karbohidrat-hasil');
            const lemakHasilSpan = document.getElementById('lemak-hasil');
            const lajuBeratHasilSpan = document.getElementById('laju-berat-hasil');
            const grafikSection = document.querySelector('.grafik-section');
            const grafikBeratTinggiCanvas = document.getElementById('grafik-berat-tinggi');
            const grafikBeratWaktuCanvas = document.getElementById('grafik-berat-waktu');
            const grafikTinggiWaktuCanvas = document.getElementById('grafik-tinggi-waktu');
            const riwayatData = document.getElementById('riwayat-data');
            const tambahRiwayatButton = document.getElementById('tambah-riwayat');

            let jumlahRiwayat = 1;

            tambahRiwayatButton.addEventListener('click', function() {
                jumlahRiwayat++;
                const newDataRow = document.createElement('div');
                newDataRow.classList.add('data-row');
                newDataRow.innerHTML = `
                    <label>Tanggal:</label>
                    <input type="date" class="tanggal-input">
                    <label>Berat (kg):</label>
                    <input type="number" class="berat-riwayat">
                    <label>Tinggi (cm):</label>
                    <input type="number" class="tinggi-riwayat">
                `;
                riwayatData.appendChild(newDataRow);
            });

            hitungButton.addEventListener('click', function() {
                const tinggiCm = parseFloat(tinggiInput.value) / 100; // Ubah ke meter
                const beratSekarang = parseFloat(beratSekarangInput.value);
                const usia = parseInt(usiaInput.value);
                const jenisKelamin = jenisKelaminSelect.value;
                const aktivitas = aktivitasSelect.value;

                // 1. Indeks Massa Tubuh (IMT)
                const imt = beratSekarang / (tinggiCm * tinggiCm);
                imtHasilSpan.textContent = imt.toFixed(2);

                // 2. Berat Badan Ideal (BBI) - Menggunakan rumus Broca yang disederhanakan
                let bbi;
                if (jenisKelamin === 'pria') {
                    bbi = (tinggiCm * 100 - 100) - (0.10 * (tinggiCm * 100 - 100));
                } else {
                    bbi = (tinggiCm * 100 - 100) - (0.15 * (tinggiCm * 100 - 100));
                }
                bbiHasilSpan.textContent = bbi.toFixed(2);

                // 3. Total Energi Harian (TEE) - Menggunakan Harris-Benedict yang dimodifikasi
                let bmr;
                if (jenisKelamin === 'pria') {
                    bmr = 88.362 + (13.397 * beratSekarang) + (4.799 * tinggiCm * 100) - (5.677 * usia);
                } else {
                    bmr = 447.593 + (9.247 * beratSekarang) + (3.098 * tinggiCm * 100) - (4.330 * usia);
                }

                let faktorAktivitas;
                switch (aktivitas) {
                    case 'ringan':
                        faktorAktivitas = 1.2;
                        break;
                    case 'sedang':
                        faktorAktivitas = 1.375;
                        break;
                    case 'berat':
                        faktorAktivitas = 1.55;
                        break;
                    case 'sangat-berat':
                        faktorAktivitas = 1.725;
                        break;
                    default:
                        faktorAktivitas = 1.2;
                }
                const tee = bmr * faktorAktivitas;
                teeHasilSpan.textContent = tee.toFixed(0);

                // 4, 5, 6. Makronutrien Harian
                const totalKalori = tee;
                const proteinKaloriMin = totalKalori * 0.10;
                const proteinKaloriMax = totalKalori * 0.15;
                const karbohidratKaloriMin = totalKalori * 0.45;
                const karbohidratKaloriMax = totalKalori * 0.65;
                const lemakKaloriMin = totalKalori * 0.20;
                const lemakKaloriMax = totalKalori * 0.35;

                const proteinGramMin = proteinKaloriMin / 4;
                const proteinGramMax = proteinKaloriMax / 4;
                const karbohidratGramMin = karbohidratKaloriMin / 4;
                const karbohidratGramMax = karbohidratKaloriMax / 4;
                const lemakGramMin = lemakKaloriMin / 9;
                const lemakGramMax = lemakKaloriMax / 9;

                proteinHasilSpan.textContent = `${proteinGramMin.toFixed(0)} - ${proteinGramMax.toFixed(0)} gram (${(10 * 100 / 100).toFixed(0)}% - ${(15 * 100 / 100).toFixed(0)}%)`;
                karbohidratHasilSpan.textContent = `${karbohidratGramMin.toFixed(0)} - ${karbohidratGramMax.toFixed(0)} gram (${(45 * 100 / 100).toFixed(0)}% - ${(65 * 100 / 100).toFixed(0)}%)`;
                lemakHasilSpan.textContent = `${lemakGramMin.toFixed(0)} - ${lemakGramMax.toFixed(0)} gram (${(20 * 100 / 100).toFixed(0)}% - ${(35 * 100 / 100).toFixed(0)}%)`;

                // 7, 8, 9, 10. Grafik dan Laju Perubahan
                const tanggalInputs = document.querySelectorAll('.tanggal-input');
                const beratRiwayatInputs = document.querySelectorAll('.berat-riwayat');
                const tinggiRiwayatInputs = document.querySelectorAll('.tinggi-riwayat');

                const riwayat = [];
                for (let i = 0; i < tanggalInputs.length; i++) {
                    const tanggal = tanggalInputs[i].value;
                    const berat = parseFloat(beratRiwayatInputs[i].value) || beratSekarang;
                    const tinggi = parseFloat(tinggiRiwayatInputs[i].value) / 100 || tinggiCm;
                    if (tanggal) {
                        riwayat.push({ tanggal: new Date(tanggal), berat: berat, tinggi: tinggi });
                    } else if (i === 0) { // Gunakan data awal jika tidak ada riwayat
                        riwayat.push({ tanggal: new Date(), berat: beratSekarang, tinggi: tinggiCm });
                    }
                }

                if (riwayat.length >= 2) {
                    riwayat.sort((a, b) => a.tanggal - b.tanggal);

                    // Laju Perubahan Berat Badan
                    const waktuDelta = (riwayat[riwayat.length - 1].tanggal - riwayat[0].tanggal) / (1000 * 60 * 60 * 24); // dalam hari
                    const beratDelta = riwayat[riwayat.length - 1].berat - riwayat[0].berat;
                    const lajuPerubahanBerat = waktuDelta === 0 ? 0 : beratDelta / waktuDelta;
                    lajuBeratHasilSpan.textContent = lajuPerubahanBerat.toFixed(2);
                } else {
                    lajuBeratHasilSpan.textContent = "Tidak cukup data riwayat";
                }

                // Membuat Grafik
                grafikSection.style.display = 'block';
                buatGrafik(grafikBeratTinggiCanvas, 'scatter', 'Berat Badan vs Tinggi Badan',
                    [{ x: riwayat[riwayat.length - 1].tinggi * 100, y: riwayat[riwayat.length - 1].berat }],
                    'Tinggi (cm)', 'Berat (kg)'
                );
                buatGrafikWaktu(grafikBeratWaktuCanvas, 'line', 'Berat Badan vs Waktu', riwayat.map(r => r.tanggal), riwayat.map(r => r.berat), 'Waktu', 'Berat (kg)');
                buatGrafikWaktu(grafikTinggiWaktuCanvas, 'line', 'Tinggi Badan vs Waktu', riwayat.map(r => r.tanggal), riwayat.map(r => r.tinggi * 100), 'Waktu', 'Tinggi (cm)');

                hasilDiv.style.display = 'block';
            });

            function buatGrafik(canvas, type, title, dataPoints, labelX, labelY) {
                new Chart(canvas, {
                    type: type,
                    data: {
                        datasets: [{
                            label: title,
                            data: dataPoints,
                            backgroundColor: 'rgba(54, 162, 235, 0.8)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: labelX
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: labelY
                                }
                            }
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: title
                            }
                        }
                    }
                });
            }

            function buatGrafikWaktu(canvas, type, title, labels, data, labelX, labelY) {
                new Chart(canvas, {
                    type: type,
                    data: {
                        labels: labels,
                        datasets: [{
                            label: title,
                            data: data,
                            fill: false,
                            borderColor: 'rgba(75, 192, 192, 1)',
                            tension: 0.1
                        }]
                    },
                    options: {
                        scales: {
                            x: {
                                type: 'time',
                                time: {
                                    unit: 'day'
                                },
                                title: {
                                    display: true,
                                    text: labelX
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: labelY
                                }
                            }
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: title
                            }
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>